{% extends "base.html" %}

{% block loggedin %}
<h2>Rota schedule</h2>
<form action="/signup" method="post">
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Morning</th>
      <th>Afternoon</th>
      <th>Evening</th>
    </tr>
  </thead>
  <tbody>
    {% macro person_select(date, cartinfo, morning_afternoon) -%}
    {% if is_admin %}
    <select name="person_{{ morning_afternoon }}_{{ date }}" {% if cartinfo['person_id'] == userid %}style="background-color:yellow;font-weight:bold;"{% endif %} >
      <option value="-1" default {% if cartinfo['person_id'] == -1 %}selected{% endif %}>&mdash;</option>
      <option value="-2" {% if cartinfo['person_id'] == -2 %}selected{% endif %}>No rota today</option>
      {% for person in people %}
      {% if person['is_active'] %}
      <option value="{{ person['id'] }}" {% if cartinfo['person_id'] == person['id'] %}selected{% endif %}>{{ person['name'] }}</option>
      {% endif %}
      {% endfor %}
    </select>
    {% elif morning_afternoon == 3 and cartinfo['person_id'] < 0 %}
    <label for="signup_{{ morning_afternoon }}_{{ date }}" style="display:inline-block;">Sign up</label> <input type="checkbox" name="signup_{{ morning_afternoon }}_{{ date }}" id="signup_{{ morning_afternoon }}_{{ date }}" />
    {% elif cartinfo['person_id'] == userid %}
    <b><mark>{{ cartinfo['person_name'] }}</mark></b><!--<label for="signup_{{ morning_afternoon }}_{{ date }}">Cancel</label><input type="checkbox" name="cancel_{{ morning_afternoon }}_{{ date }}" id="signup_{{ key }}_{{ date }}" checked />-->
    {% elif cartinfo['person_id'] == -2 %}
    <em>No rota</em>
    {% else %}
    {{ cartinfo['person_name'] }}
    {% endif %}
    {%- endmacro %}
    {% for date in dates %}
    <tr>
      <td>{{ date[0] }}</td>
      <td>{{ person_select(date[1], carts.get((date[1],1), dict(person_name="-", person_id=-1)), 1) }}</td>
      <td>{{ person_select(date[1], carts.get((date[1],2), dict(person_name="-", person_id=-1)), 2) }}</td>
      <td>{{ person_select(date[1], carts.get((date[1],3), dict(person_name="-", person_id=-1)), 3) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<input type="submit" value="Save" />
</form>
{% endblock %}
